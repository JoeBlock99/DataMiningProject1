---
title: "Proyecto 1"
author: "Juan De Leon, Maria Jose Castro, Jose Block"
date: "5/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Import libraries
library(ggplot2)
library(DataExplorer)
library(tidyverse)

# Load Data
load("DataMiningP1Project.RData")

```
# Analisis Exlporatorio
***

## Situación  Problemática
***
En Guatemala pasa que al hacer inversiones en ciertas areas como la educacion, se hace la inversion sin pensar en que sectores es mas eficiente invertir en educacion y resulta ser una inversion con un bajo impacto en el pais, porque resulta que hay sectores que lo necesitan.

## Problema científico
***
Con la informacion de nacimientos de 2009 a 2019 queremos hacer un analisis de datos para la inversion de educacion segun departamento tomando en cuenta cantidad de nacimientos por departamento y las condiciones de la madre de cada parto.

## Objetivos
***
- Averiguar que variables influyen mas en que la madre este soltera con un modelo.

- Determinar mayor taza de nacimientos por departamento y determinar orden de mayor a menor crecimiento o probabilidad de crecimiento.

- Decidir un orden de departamentos en los que se debe invertir en educacion segun los datos analizados.

## Descripción  de  los  datos
***

  Para el desarrollo de este proyecto se trabajó con la base de datos de [Estadísticas Vitales](https://www.ine.gob.gt/ine/vitales/) del Instituto Nacional de Estadística de Guatemala (INE) desde el año 2010 al año 2019. Estas estadísticas provienen de registros administrativos de nacimientos, defunciones, matrimonios y divorcios. Las estadísticas vitales brindan información importante sobre los cambios de patrones en las áreas antes mencionadas, brindando así, una visión dinámica de la población.
  
  
  Dado que esta información está en archivos .xls el paso inicial que tomo el grupo fue juntar todos los sets de datos en un solo data frame por hoja que cada archivo contiene. Dado que se trabajo con información de 10 años distintos no en todos se cuantifica la misma información, por lo que fue necesario excluir ciertos datos que en archivos recientes si hay. Se agrego una columna a cada data frame para diferenciar el año en el que se obtuvo esa información. Seguido de esto se guardaron todos los data frames, habiendo unido la informacion de los 10 archivos distintos, en un archivo .RData.
  
  
  Luego de juntar los sets de datos se clasifico cuales iban a ser relevantes para solventar la problemática anteriormente planteada. Por lo que se escogieron los siguientes sets de datos: 


*	Nacimientos por departamento de residencia de la madre, según edades simples de la madre
*	Nacimientos por estado civil de la madre, según departamento de su residencia
*	Nacimientos por estado civil de la madre, según grupos de edad
*	Nacimientos por grupos de edad de la madre, según grupos de edad del padre
*	Número de hijos(as) tenidos, según edades simples de la madre
*	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia
*	Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre
*	Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre
*	Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

  
  Una de las ventajas que se tuvo al trabajar con este set de datos es que no fue sumamente necesaria la limpieza de datos. La mayoría de las hojas se encuentran llena de datos, no hay datos N/A. Sin embargo, a lo largo de los años se agregaron nuevas columnas o cambiaron de nombre, lo que se volvió un tanto tedioso. Fue necesario que variables cambiaron o que nueva información se agregó, ya que no se trabajó con datos que no se encontraran en los 10 años.

A continuación, mostramos una clasificación de las variables por cada set de datos:

*	Nacimientos por departamento de residencia de la madre, según edades simples de la madre

    * Edad: variable cuantitativa discreta.
    * Departamento: Variable cualitativa nominal

*	Nacimientos por estado civil de la madre, según departamento de su residencia
    
    * Departamento: Variable cualitativa nominal
    * Estado Civil: Variable cualitativa nominal
    
*	Nacimientos por estado civil de la madre, según grupos de edad

    * Grupo de Edad: Variable cuantitativa discreta
    * Estado Civil: Variable cualitativa nominal

*	Nacimientos por grupos de edad de la madre, según grupos de edad del padre

    * Grupo de Edad Madre: Variable cuantitativa discreta
    * Grupo de Edad Padre: Variable cuantitativa discreta

*	Número de hijos(as) tenidos, según edades simples de la madre

    * Edad: Variable cuantitativa discreta
    * Numero de Hijos: Variable cuantitativa discreta

*	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia

    * Departamento: Variable cualitativa nominal
    * Municipio: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

*	Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre

    * Grupos Ocupacionales: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

*	Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre

    * Departamento: Variable cualitativa nominal
    * Area Geografica: Variable cualitativa nominal
    * Grupo Etnico: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

*	Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

    * Numero de hijos: variable cuantitativa discreta
    * Escolaridad de la madre: varibale cualitativa nominal

## Análisis Exploratorio
***
Para realizar el analisis, pensamos verificar que informacion nos es mas util entre las siguientes tablas:

### - Estadística Descriptiva

-	Nacimientos por departamento de residencia de la madre, según edades simples de la madre

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_por_dpto_edades_simples) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_por_dpto_edades_simples) #Cantidad de columnas
print("Estructura de los datos")
str(nac_por_dpto_edades_simples) #Estructura de los datos
print("Ultimas filas")
tail(nac_por_dpto_edades_simples,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_por_dpto_edades_simples %>% introduce()
nac_por_dpto_edades_simples %>% plot_intro()

# 2.0 Missing Values

nac_por_dpto_edades_simples %>% profile_missing()

# 3.0 Continuos Features

nac_por_dpto_edades_simples %>% plot_density()
nac_por_dpto_edades_simples %>% plot_histogram()

# 4.0 Categorical Features

# nac_por_dpto_edades_simples %>% plot_bar()

# 5.0 Relationships

# nac_por_dpto_edades_simples %>% plot_correlation()

```


- Nacimientos por departamento de residencia de la madre, segun departamento de ocurrencia

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_por_dpto) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_por_dpto) #Cantidad de columnas
print("Estructura de los datos")
str(nac_por_dpto) #Estructura de los datos
print("Ultimas filas")
tail(nac_por_dpto,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_por_dpto %>% introduce()
nac_por_dpto %>% plot_intro()

# 2.0 Missing Values

nac_por_dpto %>% profile_missing()

# 3.0 Continuos Features

nac_por_dpto %>% plot_density()
nac_por_dpto %>% plot_histogram()

# 4.0 Categorical Features

nac_por_dpto %>% plot_bar()

# 5.0 Relationships

nac_por_dpto %>% plot_correlation()

```

- *	Nacimientos por estado civil de la madre, según departamento de su residencia

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_por_estado_civil) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_por_estado_civil) #Cantidad de columnas
print("Estructura de los datos")
str(nac_por_estado_civil) #Estructura de los datos
print("Ultimas filas")
tail(nac_por_estado_civil,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_por_estado_civil %>% introduce()
nac_por_estado_civil %>% plot_intro()

# 2.0 Missing Values

nac_por_estado_civil %>% profile_missing()

# 3.0 Continuos Features

nac_por_estado_civil %>% plot_density()
nac_por_estado_civil %>% plot_histogram()

# 4.0 Categorical Features

nac_por_estado_civil %>% plot_bar()

# 5.0 Relationships

nac_por_estado_civil %>% plot_correlation()

```

-	Nacimientos por estado civil de la madre, según grupos de edad

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_por_estado_civil_por_edad) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_por_estado_civil_por_edad) #Cantidad de columnas
print("Estructura de los datos")
str(nac_por_estado_civil_por_edad) #Estructura de los datos
print("Ultimas filas")
tail(nac_por_estado_civil_por_edad,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_por_estado_civil_por_edad %>% introduce()
nac_por_estado_civil_por_edad %>% plot_intro()

# 2.0 Missing Values

nac_por_estado_civil_por_edad %>% profile_missing()

# 3.0 Continuos Features

nac_por_estado_civil_por_edad %>% plot_density()
nac_por_estado_civil_por_edad %>% plot_histogram()

# 4.0 Categorical Features

nac_por_estado_civil_por_edad %>% plot_bar()

# 5.0 Relationships

nac_por_estado_civil_por_edad %>% plot_correlation()

```

-	Nacimientos por estado civil del padre, según grupos de edad

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_por_estado_civil_padre_por_edad) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_por_estado_civil_padre_por_edad) #Cantidad de columnas
print("Estructura de los datos")
str(nac_por_estado_civil_padre_por_edad) #Estructura de los datos
print("Ultimas filas")
tail(nac_por_estado_civil_padre_por_edad,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_por_estado_civil_padre_por_edad %>% introduce()
nac_por_estado_civil_padre_por_edad %>% plot_intro()

# 2.0 Missing Values

nac_por_estado_civil_padre_por_edad %>% profile_missing()

# 3.0 Continuos Features

nac_por_estado_civil_padre_por_edad %>% plot_density()
nac_por_estado_civil_padre_por_edad %>% plot_histogram()

# 4.0 Categorical Features

nac_por_estado_civil_padre_por_edad %>% plot_bar()

# 5.0 Relationships

nac_por_estado_civil_padre_por_edad %>% plot_correlation()

```

-	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_edad_madre_departamento_municipio) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_edad_madre_departamento_municipio) #Cantidad de columnas
print("Estructura de los datos")
str(nac_edad_madre_departamento_municipio) #Estructura de los datos
print("Ultimas filas")
tail(nac_edad_madre_departamento_municipio,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_edad_madre_departamento_municipio %>% introduce()
nac_edad_madre_departamento_municipio %>% plot_intro()

# 2.0 Missing Values

nac_edad_madre_departamento_municipio %>% profile_missing()

# 3.0 Continuos Features

nac_edad_madre_departamento_municipio %>% plot_density()
nac_edad_madre_departamento_municipio %>% plot_histogram()

# 4.0 Categorical Features

nac_edad_madre_departamento_municipio %>% plot_bar()

# 5.0 Relationships

nac_edad_madre_departamento_municipio %>% plot_correlation()

```

- Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_edad_madre_ocupacion) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_edad_madre_ocupacion) #Cantidad de columnas
print("Estructura de los datos")
str(nac_edad_madre_ocupacion) #Estructura de los datos
print("Ultimas filas")
tail(nac_edad_madre_ocupacion,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_edad_madre_ocupacion %>% introduce()
nac_edad_madre_ocupacion %>% plot_intro()

# 2.0 Missing Values

nac_edad_madre_ocupacion %>% profile_missing()

# 3.0 Continuos Features

nac_edad_madre_ocupacion %>% plot_density()
nac_edad_madre_ocupacion %>% plot_histogram()

# 4.0 Categorical Features

nac_edad_madre_ocupacion %>% plot_bar()

# 5.0 Relationships

# nac_edad_madre_ocupacion %>% plot_correlation()

```

- Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_edad_madre_depto_area_etnia) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_edad_madre_depto_area_etnia) #Cantidad de columnas
print("Estructura de los datos")
str(nac_edad_madre_depto_area_etnia) #Estructura de los datos
print("Ultimas filas")
tail(nac_edad_madre_depto_area_etnia,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_edad_madre_depto_area_etnia %>% introduce()
nac_edad_madre_depto_area_etnia %>% plot_intro()

# 2.0 Missing Values

nac_edad_madre_depto_area_etnia %>% profile_missing()

# 3.0 Continuos Features

nac_edad_madre_depto_area_etnia %>% plot_density()
nac_edad_madre_depto_area_etnia %>% plot_histogram()

# 4.0 Categorical Features

nac_edad_madre_depto_area_etnia %>% plot_bar()

# 5.0 Relationships

nac_edad_madre_depto_area_etnia %>% plot_correlation()

```

- Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

```{r echo=FALSE}

print("Cantidad de filas")
nrow(nac_escolaridad_madre) #Cantidad de filas
print("Cantidad de columnas")
ncol(nac_escolaridad_madre) #Cantidad de columnas
print("Estructura de los datos")
str(nac_escolaridad_madre) #Estructura de los datos
print("Ultimas filas")
tail(nac_escolaridad_madre,3) #Muestra las últimas filas

# 1.0 Data Introduction

nac_escolaridad_madre %>% introduce()
nac_escolaridad_madre %>% plot_intro()

# 2.0 Missing Values

nac_escolaridad_madre %>% profile_missing()

# 3.0 Continuos Features

nac_escolaridad_madre %>% plot_density()
nac_escolaridad_madre %>% plot_histogram()

# 4.0 Categorical Features

nac_escolaridad_madre %>% plot_bar()

# 5.0 Relationships

nac_escolaridad_madre %>% plot_correlation()

```

```{r echo=FALSE}
data.frame("Variable"=c(colnames(dpto_res_ocu)), "Tipo de Variable"=c("Cualitativa Nominal", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta","Cuantitativa Discreta", "Cuantitativa Discreta","Cuantitativa Discreta"))
```


### - Gráficos  Exploratorios
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Separar la info para dar graficos 
library(tidyverse)
dpto_res_ocu_tot <- dpto_res_ocu %>% filter(...1 == "Todos los departamentos")
dpto_res_ocuf = dpto_res_ocu %>% filter(...1 != "Todos los departamentos")

#Graficar
library(ggplot2)
library(reshape2)
library(grid)
#Cantidad de nacimientos en el transcurso del tiempo 
#por cada departamento.
#Selecciono la info para tener los departamentos en una variable
deptotanio <- dpto_res_ocu_tot %>% select(3,4,5,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
#Se repite...
deptotanio <- dpto_res_ocu_tot %>% select(6,7,8,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
deptotanio <- dpto_res_ocu_tot %>% select(8,10,11,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
deptotanio <- dpto_res_ocu_tot %>% select(12,13,14,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
deptotanio <- dpto_res_ocu_tot %>% select(15,16,17,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
deptotanio <- dpto_res_ocu_tot %>% select(18,19,20,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
deptotanio <- dpto_res_ocu_tot %>% select(21,22,23,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
deptotanio <- dpto_res_ocu_tot %>% select(24,25,26,27)
d <- melt(deptotanio, id.vars="anio")
ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, ncol = 1, scales = "free")
```

### - Correlaciones  Entre  las  Variables

Para hacer el estudio de correlación para cada tabla, solo se puede aplicar a variables cuantitativas, se investigó si se puede convertir las variables cuantitativas a numeros diferentes aleatorios, pero las únicas formas que encontramos eran muy complejas en cuestion de tiempo. Por esta razón, se hizo el estudio de correlaión solo entre vaariables cuantitativas actuales.
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Check correlation
library(corrplot)
frstselect <- subset (dpto_res_ocu, select = c(2:27))
M <- cor(frstselect)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(M,  method = "color", col = col(200), order = "hclust", number.cex = .35,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)

scndselect <- subset (nac_edad_madre_departamento_municipio, select = c(3:14))
M2 <- cor(scndselect)
corrplot(M2,  method = "color", col = col(200), order = "hclust", number.cex = .7,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)

trdselect <- subset (nac_depto_sexo_peso, select = c(3:6))
M3 <- cor(trdselect)
corrplot(M3,  method = "color", col = col(200), order = "hclust", number.cex = 1.5,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)
frthselect <- subset (nac_por_estado_civil, select = c(2:7))
M4 <- cor(frthselect)
corrplot(M4,  method = "color", col = col(200), order = "hclust", number.cex = 1.5,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)
fthselect <- subset (nac_vivos_muertos_por_dpto, select = c(2:9))
fthselect = fthselect[rowSums(is.na(fthselect)) == 0, ]
M5 <- cor(fthselect)
corrplot(M5,  method = "color", col = col(200), order = "hclust", number.cex = 1,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)

sthselect <- subset (nac_edad_madre_depto_area_etnia, select = c(3:14))
sthselect = sthselect[rowSums(is.na(sthselect)) == 0, ]
M6 <- cor(sthselect)
corrplot(M6,  method = "color", col = col(200), order = "hclust", number.cex = .8,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)
```

### - Variables Categóricas
### - Número de Clusters
### - Agrupamiento
### - Calidad del Agrupamiento

## Hallazgos y conclusiones
***
### - Hallazgos en el análisis exploratorio
### - Nombre a los grupos
### - Conclusiones