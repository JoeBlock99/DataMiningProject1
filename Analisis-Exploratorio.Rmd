---
title: "Proyecto 1"
author: "Juan De Leon, Maria Jose Castro, Jose Block"
date: "5/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Import libraries
library(ggplot2)
library(DataExplorer)
library(tidyverse)
library(reshape2)
library(grid)
library(corrplot)
 
# Load Data
load("DataMiningP1Project.RData")

```
# Analisis Exlporatorio
***

## Situación  Problemática
***
En Guatemala se tiene uno de los índices de desnutrición infantil más altos de latinoamérica, al mismo tiempo que se tiene una muy baja tasa de alfabetización. También es bien conocido que el sistema de salud del país es muy precario y la mayoría de personas del interior del país no tienen acceso ni a un centro de salud o control natal, también la mayoría de los partos se dan con comadronas y no en centros asistidos por un médico. 

Desde esta perspectiva de los dos puntos dos datos anteriores parece que como país no se brindan las condiciones y oportunidades necesarias para poder permitir florecer a la niñez. 

Lo que buscamos con el siguiente trabajo es poder identificar cuáles son algunos de los factores más influyentes en los nacimientos y poder identificar patrones para plantear soluciones. Desde la búsqueda por departamentos, información que se pueda obtener de la madre, edades, etc. 

Con identificar esto buscamos determinar el departamento en mayor necesidad de educación sexual, centros asistenciales, control prenatal, etc. En Guatemala pasa que al hacer inversiones en ciertas áreas como la educación, se hace la inversión sin pensar en qué sectores es más eficiente invertir en educación y resulta ser una inversión con un bajo impacto en el país, porque resulta que hay sectores que lo necesitan.


## Problema científico
***
Con la informacion de nacimientos de 2009 a 2019 queremos hacer un analisis de datos para la inversion de educacion segun departamento tomando en cuenta cantidad de nacimientos por departamento y las condiciones de la madre de cada parto.

Como segundo objetivo ya mencionado será identificar las condiciones de cada parto y las más comunes según el departamento. 


## Objetivos
***
- Determinar cuales son las variables más influyentes o repetitivas en que una madre sea soltera por medio de un modelo.
- Identificar la correlación (si es que existe) entre el departamento con mayor tasa de nacimientos y predecir como esta aumentará.

- Determinar los departamentos en los que más se debe invertir en educación sexual según los índices obtenidos. 

- Realizar hallazgos para posibles analisis de el set de datos explorado. 

## Descripción  de  los  datos
***

  Para el desarrollo de este proyecto se trabajó con la base de datos de [Estadísticas Vitales](https://www.ine.gob.gt/ine/vitales/) del Instituto Nacional de Estadística de Guatemala (INE) desde el año 2010 al año 2019. Estas estadísticas provienen de registros administrativos de nacimientos, defunciones, matrimonios y divorcios. Las estadísticas vitales brindan información importante sobre los cambios de patrones en las áreas antes mencionadas, brindando así, una visión dinámica de la población.
  
  
  Dado que esta información está en archivos .xls el paso inicial que tomo el grupo fue juntar todos los sets de datos en un solo data frame por hoja que cada archivo contiene. Dado que se trabajo con información de 10 años distintos no en todos se cuantifica la misma información, por lo que fue necesario excluir ciertos datos que en archivos recientes si hay. Se agrego una columna a cada data frame para diferenciar el año en el que se obtuvo esa información. Seguido de esto se guardaron todos los data frames, habiendo unido la informacion de los 10 archivos distintos, en un archivo .RData.
  
  
  Luego de juntar los sets de datos se clasifico cuales iban a ser relevantes para solventar la problemática anteriormente planteada. Por lo que se escogieron los siguientes sets de datos: 


*	Nacimientos por departamento de residencia de la madre, según edades simples de la madre
*	Nacimientos por estado civil de la madre, según departamento de su residencia
*	Nacimientos por estado civil de la madre, según grupos de edad
*	Nacimientos por grupos de edad de la madre, según grupos de edad del padre
*	Número de hijos(as) tenidos, según edades simples de la madre
*	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia
*	Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre
*	Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre
*	Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

  
  Una de las ventajas que se tuvo al trabajar con este set de datos es que no fue sumamente necesaria la limpieza de datos. La mayoría de las hojas se encuentran llena de datos, no hay datos N/A. Sin embargo, a lo largo de los años se agregaron nuevas columnas o cambiaron de nombre, lo que se volvió un tanto tedioso. Fue necesario que variables cambiaron o que nueva información se agregó, ya que no se trabajó con datos que no se encontraran en los 10 años.

A continuación, mostramos una clasificación de las variables por cada set de datos:

*	Nacimientos por departamento de residencia de la madre, según edades simples de la madre

    * Edad: variable cuantitativa discreta.
    * Departamento: Variable cualitativa nominal

```{r echo=FALSE}
nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-2) %>% introduce()
```

* Nacimientos por departamento de residencia de la madre, segun departamento de ocurrencia
    * Mes: Variable cualitativa ordinal
    * Departamento: Variable cualitativa nominal
    * Total: Cuantitativa discreta
    * Hombres: Cuantitativa discreta
    * Mujeres: Cuantitativa discreta
    * Año: Cuantitativa discreta

```{r echo=FALSE}
nac_por_dpto %>% filter(Mes != "Todos los meses") %>% filter(Departamento.de.residencia != "Todos los departamentos") %>% select(-3) %>% introduce()
```

*	Nacimientos por estado civil de la madre, según departamento de su residencia
    
    * Departamento: Variable cualitativa nominal
    * Estado Civil: Variable cualitativa nominal

```{r echo=FALSE}
nac_por_estado_civil %>% filter(Departamento.de.residencia != "Todos los departamentos") %>% select(-2) %>% introduce()
```
    
*	Nacimientos por estado civil de la madre, según grupos de edad

    * Grupo de Edad: Variable cuantitativa discreta
    * Estado Civil: Variable cualitativa nominal
    
```{r echo=FALSE}
nac_por_estado_civil_por_edad %>% filter(Grupos.de.edad != "Todas las edades") %>% select(-2) %>% introduce()
```

*	Nacimientos por grupos de edad de la madre, según grupos de edad del padre

    * Grupo de Edad Madre: Variable cuantitativa discreta
    * Grupo de Edad Padre: Variable cuantitativa discreta

*	Número de hijos(as) tenidos, según edades simples de la madre

    * Edad: Variable cuantitativa discreta
    * Numero de Hijos: Variable cuantitativa discreta

*	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia

    * Departamento: Variable cualitativa nominal
    * Municipio: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta
    
```{r echo=FALSE}
nac_edad_madre_departamento_municipio %>% filter(Departamento.de.residencia != "Todos los departamentos") %>% filter(Municipios != "Todos los municipios") %>% select(-3) %>% introduce()
```

*	Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre

    * Grupos Ocupacionales: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

```{r echo=FALSE}
nac_edad_madre_ocupacion %>% filter(Grupos.ocupacionales != "Todos los grupos ocupacionales") %>% select(-2) %>% introduce()
```

*	Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre

    * Departamento: Variable cualitativa nominal
    * Area Geografica: Variable cualitativa nominal
    * Grupo Etnico: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

```{r echo=FALSE}
nac_edad_madre_depto_area_etnia %>% filter(Departamento.de.ocurrencia != "Todos los departamentos") %>% filter(Pueblo.de.pertenencia.de.la.madre != "Todos los grupos étnicos") %>% select(-3) %>% introduce()
```

*	Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

    * Numero de hijos: variable cuantitativa discreta
    * Escolaridad de la madre: varibale cualitativa nominal

```{r echo=FALSE}
nac_escolaridad_madre %>% filter(Número.de.hijos.as. != "Todos los hijos") %>% select(-2) %>% introduce()
```
Tambien se revisó que la mayoría de variables no tubieran duplicados por tíldes, principalmente en la columnas de departamentos y mucicipios.

```{r echo=FALSE}

print("dpto_res_ocu")
unique(dpto_res_ocu$...1)

print("nac_edad_madre_departamento_municipio")
unique(nac_edad_madre_departamento_municipio$Departamento.de.residencia)
unique(nac_edad_madre_departamento_municipio$Municipios)

print("nac_depto_sexo_peso")
unique(nac_depto_sexo_peso$Departamento.de.residencia)

print("nac_por_estado_civil")
unique(nac_depto_sexo_peso$Departamento.de.residencia)

print("nac_vivos_muertos_por_dpto")
unique(nac_vivos_muertos_por_dpto$Departamento.de.residencia)

print("nac_edad_madre_depto_area_etnia")
unique(nac_edad_madre_depto_area_etnia$Departamento.de.ocurrencia)
unique(nac_edad_madre_depto_area_etnia$Pueblo.de.pertenencia.de.la.madre)

```
En las últimas dos tablas, podemos notar que hay repetidas ciertas palabras por tilde o escritura, los errores notorios son los siguientes:
- tíldes
-Xinka/Xinca


## Análisis Exploratorio
***

Para realizar el analisis, pensamos verificar que informacion nos es mas util entre las siguientes tablas:

- Nacimientos por departamento de residencia de la madre, según departamento de ocurrencia							

- Nacimientos por estado civil de la madre, según departamento de su residencia							

- Nacimientos vivos y muertos por tipo de parto, según departamento de residencia de la madre							

- Nacimientos por sexo, según departamento de residencia de la madre y peso del niño(a) al nacer							

- Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia							

- Nacimientos por grupos de edad de la madre, según departamento y pueblo de pertenencia de la madre

- Nacimientos por lugar donde ocurrió el nacimiento, según departamento y municipio de residencia de la madre	


### - Estadística Descriptiva

A continuación se muestran los nombres de cada dataframe y su estadística descriptiva por cada una de las tablas ya mencionadas.

- Nacimientos por departamento de residencia de la madre, según departamento de ocurrencia

Resumen estadístico de variables:

```{r echo=FALSE}
smry1 <- dpto_res_ocu %>% select(2:26)
summary(smry1)
unique(dpto_res_ocu$...1)
```

- Nacimientos por estado civil de la madre, según departamento de su residencia				

Resumen estadístico de variables:

```{r echo=FALSE}
smry2 <- nac_por_estado_civil %>% select(2:6)
summary(smry2)
```

- Nacimientos vivos y muertos por tipo de parto, según departamento de residencia de la madre		

Resumen estadístico de variables:

```{r echo=FALSE}
smry3 <- nac_vivos_muertos_por_dpto %>% select(2:7)
summary(smry3)
```

- Nacimientos por sexo, según departamento de residencia de la madre y peso del niño(a) al nacer							

Resumen estadístico de variables:

```{r echo=FALSE}
nac_depto_sexo_peso$Mujeres = abs(nac_depto_sexo_peso$Mujeres)
smry4 <- nac_depto_sexo_peso %>% select(2:5)
summary(smry4)
```

- Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia

Resumen estadístico de variables:

```{r echo=FALSE}
smry5 <- nac_edad_madre_departamento_municipio %>% select(3:13)
summary(smry5)
```

- Nacimientos por grupos de edad de la madre, según departamento y pueblo de pertenencia de la madre

Resumen estadístico de variables:

```{r echo=FALSE}
smry6 <- nac_edad_madre_depto_area_etnia %>% select(2:13)
summary(smry6)
```

- Nacimientos por lugar donde ocurrió el nacimiento, según departamento y municipio de residencia de la madre	

Resumen estadístico de variables:

```{r echo=FALSE}
smry7 <- nac_lugar %>% select(3:11)
summary(smry7)

```

### - Gráficos  Exploratorios

- Nacimientos por departamento

Dentro de las preguntas interesantes, orientadas a nuestra problematica, surgio la curiosidad por saber cuantos nacimientos hubo a lo largo de 10 años en todos los departamentos de la republica. Para resolver esta duda se utilizo el data set de nacimientos por  departamento. Obtuvimos los siguientes resultados:

```{r echo=FALSE}

nac_por_dpto_todas_las_edades <- nac_por_dpto_edades_simples %>% filter(Edad == "Todas las edades") %>% select(-1, -2)

# Plot of births per city per year
barplot(as.matrix(nac_por_dpto_todas_las_edades %>% select(-25)), beside=TRUE, las=2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Separar la info para dar graficos 
#Guatemala
#Zacapa
#Totonicapán
#Suchitepéquez
#Sololá
#Santa Rosa
#San Marcos
#Sacatepéquez

#Retalhuleu
#Quiché
#Quetzaltenango 
#Petén
#Jutiapa
#Jalapa
#Izabal

#Huehuetenango
#Escuintla
#El Progreso
#Chiquimula
#Chimaltenango
#Baja Verapaz
#Alta Verapaz

nac_depto_sexo_peso0 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Guatemala" & Peso == "Todos los pesos")

nac_depto_sexo_peso1 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Suchitepéquez" & Peso == "Todos los pesos")

nac_depto_sexo_peso2 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Zacapa" & Peso == "Todos los pesos")

nac_depto_sexo_peso3 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Totonicapán" & Peso == "Todos los pesos")

nac_depto_sexo_peso4 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Sololá" & Peso == "Todos los pesos")

nac_depto_sexo_peso5 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Santa Rosa" & Peso == "Todos los pesos")

nac_depto_sexo_peso6 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "San Marcos" & Peso == "Todos los pesos")

nac_depto_sexo_peso7 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Sacatepéquez" & Peso == "Todos los pesos")

nac_depto_sexo_peso8 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Retalhuleu" & Peso == "Todos los pesos")

nac_depto_sexo_peso9 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Quiché" & Peso == "Todos los pesos")

nac_depto_sexo_peso10 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Quetzaltenango" & Peso == "Todos los pesos")

nac_depto_sexo_peso11 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Petén" & Peso == "Todos los pesos")

nac_depto_sexo_peso12 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Jutiapa" & Peso == "Todos los pesos")

nac_depto_sexo_peso13 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Jalapa" & Peso == "Todos los pesos")

nac_depto_sexo_peso14 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Izabal" & Peso == "Todos los pesos")

nac_depto_sexo_peso15 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Huehuetenango" & Peso == "Todos los pesos")

nac_depto_sexo_peso16 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Escuintla" & Peso == "Todos los pesos")

nac_depto_sexo_peso17 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "El Progreso" & Peso == "Todos los pesos")

nac_depto_sexo_peso18 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Chiquimula" & Peso == "Todos los pesos")

nac_depto_sexo_peso19 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Chimaltenango" & Peso == "Todos los pesos")

nac_depto_sexo_peso20 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Baja Verapaz" & Peso == "Todos los pesos")

nac_depto_sexo_peso21 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Alta Verapaz" & Peso == "Todos los pesos")

#Graficar Guatemala por aparte y luego se grafica de 7 en 7.

ggplot(data=nac_depto_sexo_peso0, aes(x=anio, y=Total, group=1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en Guatemala(departamento)") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)

d <- melt(list(Suchitepequez = nac_depto_sexo_peso1,Zacapa = nac_depto_sexo_peso2,Totonicapan = nac_depto_sexo_peso3,Solola = nac_depto_sexo_peso4,Santa_Rosa = nac_depto_sexo_peso5,San_Marcos = nac_depto_sexo_peso6, Sacatepequez = nac_depto_sexo_peso7), id.vars = c("anio", "Total"))
ggplot(d, aes(x=anio, y=Total, colour = L1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en departamentos de Guatemala") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)


d2 <- melt(list(Retalhuleu = nac_depto_sexo_peso8,Quiche = nac_depto_sexo_peso9,Quetzaltenango = nac_depto_sexo_peso10,Peten = nac_depto_sexo_peso11,Jutiapa = nac_depto_sexo_peso12,Jalapa = nac_depto_sexo_peso13, Izabal = nac_depto_sexo_peso14), id.vars = c("anio", "Total"))
ggplot(d2, aes(x=anio, y=Total, colour = L1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en departamentos de Guatemala") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)

d3 <- melt(list(Huehuetenango = nac_depto_sexo_peso15,Escuintla = nac_depto_sexo_peso16,El_Progreso = nac_depto_sexo_peso17,Chiquimula = nac_depto_sexo_peso18,Chimaltenango = nac_depto_sexo_peso19,Baja_Verapaz = nac_depto_sexo_peso20, Alta_Verapaz = nac_depto_sexo_peso21), id.vars = c("anio", "Total"))
ggplot(d3, aes(x=anio, y=Total, colour = L1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en departamentos de Guatemala") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)

```

Porcentaje de mortandad por nacimiento en cada departamento:

```{r echo=FALSE}
#Se genera una columna con un porcentaje de muertes por nacimiento en pais por anio
nac_vivos_muertos_por_dpto$prmort <- nac_vivos_muertos_por_dpto$Nacidos.muertos / nac_vivos_muertos_por_dpto$Total..
nac_vivos_muertos_por_dpto$prmort = nac_vivos_muertos_por_dpto$prmort*100

#Separar en grupos para graficar
nac_vivos_muertos_por_dpto0 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Guatemala")

nac_vivos_muertos_por_dpto1 <-nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Suchitepéquez")

nac_vivos_muertos_por_dpto2 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Zacapa")

nac_vivos_muertos_por_dpto3 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Totonicapán")

nac_vivos_muertos_por_dpto4 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Sololá")

nac_vivos_muertos_por_dpto5 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Santa Rosa")

nac_vivos_muertos_por_dpto6 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "San Marcos")

nac_vivos_muertos_por_dpto7 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Sacatepéquez")

nac_vivos_muertos_por_dpto8 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Retalhuleu")

nac_vivos_muertos_por_dpto9 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Quiché")

nac_vivos_muertos_por_dpto10 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Quetzaltenango")

nac_vivos_muertos_por_dpto11 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Petén")

nac_vivos_muertos_por_dpto12 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Jutiapa")

nac_vivos_muertos_por_dpto13 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Jalapa")

nac_vivos_muertos_por_dpto14 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Izabal")

nac_vivos_muertos_por_dpto15 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Huehuetenango")

nac_vivos_muertos_por_dpto16 <- nac_vivos_muertos_por_dpto%>% filter(Departamento.de.residencia == "Escuintla")

nac_vivos_muertos_por_dpto17 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "El Progreso")

nac_vivos_muertos_por_dpto18 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Chiquimula")

nac_vivos_muertos_por_dpto19 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Chimaltenango")

nac_vivos_muertos_por_dpto20 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Baja Verapaz")

nac_vivos_muertos_por_dpto21 <- nac_vivos_muertos_por_dpto %>% filter(Departamento.de.residencia == "Alta Verapaz")

d4 <- melt(list(Guatemala = nac_vivos_muertos_por_dpto0,Suchitepequez = nac_vivos_muertos_por_dpto1,Zacapa = nac_vivos_muertos_por_dpto2,Totonicapan = nac_vivos_muertos_por_dpto3,Solola = nac_vivos_muertos_por_dpto4,Santa_Rosa = nac_vivos_muertos_por_dpto5,San_Marcos = nac_vivos_muertos_por_dpto6, Sacatepequez = nac_vivos_muertos_por_dpto7), id.vars = c("anio", "prmort"))
ggplot(d4, aes(x=anio, y=prmort, colour = L1)) + geom_line() + geom_point() + ggtitle("Porcentaje de muertes por total de nacimientos en departamentos") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_vivos_muertos_por_dpto1$anio), breaks = nac_vivos_muertos_por_dpto1$anio)

d5 <- melt(list(Retalhuleu = nac_vivos_muertos_por_dpto8,Quiche = nac_vivos_muertos_por_dpto9,Quetzaltenango = nac_vivos_muertos_por_dpto10,Peten = nac_vivos_muertos_por_dpto11,Jutiapa = nac_vivos_muertos_por_dpto12,Jalapa = nac_vivos_muertos_por_dpto13, Izabal = nac_vivos_muertos_por_dpto14), id.vars = c("anio", "prmort"))
ggplot(d5, aes(x=anio, y=prmort, colour = L1)) + geom_line() + geom_point() + ggtitle("Porcentaje de muertes por total de nacimientos en departamentos") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_vivos_muertos_por_dpto1$anio), breaks = nac_vivos_muertos_por_dpto1$anio)

d6 <- melt(list(Huehuetenango = nac_vivos_muertos_por_dpto15,Escuintla = nac_vivos_muertos_por_dpto16,El_Progreso = nac_vivos_muertos_por_dpto17,Chiquimula = nac_vivos_muertos_por_dpto18,Chimaltenango = nac_vivos_muertos_por_dpto19,Baja_Verapaz = nac_vivos_muertos_por_dpto20, Alta_Verapaz = nac_vivos_muertos_por_dpto21), id.vars = c("anio", "prmort"))
ggplot(d6, aes(x=anio, y=prmort, colour = L1)) + geom_line() + geom_point() + ggtitle("Porcentaje de muertes por total de nacimientos en departamentos") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_vivos_muertos_por_dpto1$anio), breaks = nac_vivos_muertos_por_dpto1$anio)
```

Porcentaje de mujeres solteras por cada anio en cada departamento.

```{r echo=FALSE}
#Se genera una columna con un porcentaje de muertes por nacimiento en pais por anio
nac_por_estado_civil$prsoltera <- nac_por_estado_civil$Soltera / nac_por_estado_civil$Total
nac_por_estado_civil$prsoltera = nac_por_estado_civil$prsoltera*100

nac_por_estado_civil0 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Guatemala")

nac_por_estado_civil1 <-nac_por_estado_civil %>% filter(Departamento.de.residencia == "Suchitepéquez")

nac_por_estado_civil2 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Zacapa")

nac_por_estado_civil3 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Totonicapán")

nac_por_estado_civil4 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Sololá")

nac_por_estado_civil5 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Santa Rosa")

nac_por_estado_civil6 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "San Marcos")

nac_por_estado_civil7 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Sacatepéquez")

nac_por_estado_civil8 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Retalhuleu")

nac_por_estado_civil9 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Quiché")

nac_por_estado_civil10 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Quetzaltenango")

nac_por_estado_civil11 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Petén")

nac_por_estado_civil12 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Jutiapa")

nac_por_estado_civil13 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Jalapa")

nac_por_estado_civil14 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Izabal")

nac_por_estado_civil15 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Huehuetenango")

nac_por_estado_civil16 <- nac_por_estado_civil%>% filter(Departamento.de.residencia == "Escuintla")

nac_por_estado_civil17 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "El Progreso")

nac_por_estado_civil18 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Chiquimula")

nac_por_estado_civil19 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Chimaltenango")

nac_por_estado_civil20 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Baja Verapaz")

nac_por_estado_civil21 <- nac_por_estado_civil %>% filter(Departamento.de.residencia == "Alta Verapaz")

d7 <- melt(list(Guatemala = nac_por_estado_civil0,Suchitepequez = nac_por_estado_civil1,Zacapa = nac_por_estado_civil2,Totonicapan = nac_por_estado_civil3,Solola = nac_por_estado_civil4,Santa_Rosa = nac_por_estado_civil5,San_Marcos = nac_por_estado_civil6, Sacatepequez = nac_por_estado_civil7), id.vars = c("anio", "prsoltera"))
ggplot(d7, aes(x=anio, y=prsoltera, colour = L1)) + geom_line() + geom_point() + ggtitle("Porcentaje de mujeres solteras por anio") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_por_estado_civil1$anio), breaks = nac_por_estado_civil1$anio)

d8 <- melt(list(Retalhuleu = nac_por_estado_civil8,Quiche = nac_por_estado_civil9,Quetzaltenango = nac_por_estado_civil10,Peten = nac_por_estado_civil11,Jutiapa = nac_por_estado_civil12,Jalapa = nac_por_estado_civil13, Izabal = nac_por_estado_civil14), id.vars = c("anio", "prsoltera"))
ggplot(d8, aes(x=anio, y=prsoltera, colour = L1)) + geom_line() + geom_point() + ggtitle("Porcentaje de mujeres solteras por anio") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_por_estado_civil1$anio), breaks = nac_por_estado_civil1$anio)

d9 <- melt(list(Huehuetenango = nac_por_estado_civil15,Escuintla = nac_por_estado_civil16,El_Progreso = nac_por_estado_civil17,Chiquimula = nac_por_estado_civil18,Chimaltenango = nac_por_estado_civil19,Baja_Verapaz = nac_por_estado_civil20, Alta_Verapaz = nac_por_estado_civil21), id.vars = c("anio", "prsoltera"))
ggplot(d9, aes(x=anio, y=prsoltera, colour = L1)) + geom_line() + geom_point() + ggtitle("Porcentaje de mujeres solteras por anio") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_por_estado_civil1$anio), breaks = nac_por_estado_civil1$anio)
```


Si analizamos individualmente los departamentos observamos que las cifras van en aumento, alcanzan un maximo y luego descienden.


```{r echo=FALSE}
plot_boxplot(nac_por_dpto_todas_las_edades, by="anio")
```

Tambien nos preguntamos como se distribuian los datos en relacion con los nacimientos, el peso del bebe y su departamento de nacimiento. Se obtuvieron los siguientes resultados:

```{r echo=FALSE}

listado_de_departamentos <- nac_depto_sexo_peso$Departamento.de.residencia
listado_de_departamentos <- listado_de_departamentos[!duplicated(listado_de_departamentos)]

for (variable in listado_de_departamentos) {
  print(variable)
  nac_guatemala_sexo_peso <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == variable) %>% filter(Peso != "Todos los pesos") %>% select(-1, -4, -5)
nac_guatemala_sexo_peso_clean <- aggregate(nac_guatemala_sexo_peso$Total, by=list(nac_guatemala_sexo_peso$Peso), FUN = sum)
barplot(nac_guatemala_sexo_peso_clean$x, names.arg = nac_guatemala_sexo_peso_clean$Group.1, las=2)
}

#nac_guatemala_sexo_peso <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Guatemala") %>% filter(Peso != "Todos los pesos") %>% select(-1, -4, -5)
#nac_guatemala_sexo_peso_clean <- aggregate(nac_guatemala_sexo_peso$Total, by=list(nac_guatemala_sexo_peso$Peso), FUN = sum)
#barplot(nac_guatemala_sexo_peso_clean$x, names.arg = nac_guatemala_sexo_peso_clean$Group.1, las=2)

```

Luego de esto se quizo ver como era la distribucion de nacimientos por edades, se obtuvieron los siguientes resultados:

```{r echo=FALSE}
nac_por_edad <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(1, 2, 27)
nac_por_edad <- aggregate(nac_por_dpto_edades_simples$Total, by=list(nac_por_dpto_edades_simples$Edad), FUN=sum)
nac_por_edad <- head(nac_por_edad, - 1)
barplot(nac_por_edad$x, names.arg = nac_por_edad$Group.1, las=2)
```

### - Correlaciones  Entre  las  Variables

Para hacer el estudio de correlación para cada tabla, solo se puede aplicar a variables cuantitativas, se investigó si se puede convertir las variables cuantitativas a numeros diferentes aleatorios, pero las únicas formas que encontramos eran muy complejas en cuestion de tiempo. Por esta razón, se hizo el estudio de correlaión solo entre variables cuantitativas actuales.
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Check correlation
frstselect <- subset (dpto_res_ocu, select = c(2:27))
M <- cor(frstselect)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(M,  method = "color", col = col(200), order = "hclust", number.cex = .35,
         addCoef.col = "black",
         tl.col = "black",
         sig.level = 0.50, insig = "blank", 
         diag = FALSE)
scndselect <- subset (nac_edad_madre_departamento_municipio, select = c(3:14))
M2 <- cor(scndselect)
corrplot(M2,  method = "color", col = col(200), order = "hclust", number.cex = .7,
         addCoef.col = "black",
         tl.col = "black",
         sig.level = 0.50, insig = "blank",
         diag = FALSE)

trdselect <- subset (nac_depto_sexo_peso, select = c(3:6))
M3 <- cor(trdselect)
corrplot(M3,  method = "color", col = col(200), order = "hclust", number.cex = 1.5,
         addCoef.col = "black", 
         tl.col = "black",
         sig.level = 0.50, insig = "blank",
         diag = FALSE)

frthselect <- subset (nac_por_estado_civil, select = c(2:7))
M4 <- cor(frthselect)
corrplot(M4,  method = "color", col = col(200), order = "hclust", number.cex = 1.5,
         addCoef.col = "black",
         tl.col = "black",
         sig.level = 0.50, insig = "blank",
         diag = FALSE)
fthselect <- subset (nac_vivos_muertos_por_dpto, select = c(2:9))
fthselect = fthselect[rowSums(is.na(fthselect)) == 0, ]
M5 <- cor(fthselect)
corrplot(M5,  method = "color", col = col(200), order = "hclust", number.cex = 1,
         addCoef.col = "black",
         tl.col = "black",
         sig.level = 0.50, insig = "blank", 
         diag = FALSE)
sthselect <- subset (nac_edad_madre_depto_area_etnia, select = c(3:14))
sthselect = sthselect[rowSums(is.na(sthselect)) == 0, ]
M6 <- cor(sthselect)
corrplot(M6,  method = "color", col = col(200), order = "hclust", number.cex = .8,
         addCoef.col = "black", 
         tl.col = "black",
         sig.level = 0.50, insig = "blank",
         diag = FALSE)

svnthselect <- subset (nac_por_dpto_edades_simples, select = c(2:24))
svnthselect = svnthselect[rowSums(is.na(svnthselect)) == 0, ]
M7 <- cor(svnthselect)
corrplot(M7,  method = "color", col = col(200), order = "hclust", number.cex = .5,
         addCoef.col = "black", 
         tl.col = "black",
         sig.level = 0.2, insig = "blank",
         diag = FALSE)


M8 <- cor(fthselect,frthselect)
corrplot(M8,  method = "color", col = col(200), number.cex = .9,
         addCoef.col = "black", 
         tl.col = "black", 
         sig.level = 0.9)

#M11 <- cor(scndselect,frthselect)
#corrplot(M11,  method = "color", col = col(200), number.cex = .5,
#         addCoef.col = "black", # Add coefficient of correlation
#         tl.col = "black", 
#         # Text label color and rotation
#         # Combine with significance
#         sig.level = 0.9)


```

### - Variables Categóricas
 Hacer arbol por tabla, para verificar que tabla puede predecir a que departamento pertenece cada fila de las tablas.
 
### - Número de Clusters

Para analizar de mejor manera la informacion se hara un agrupamiento. Por lo que se hara una grafica de codo para determinar la cantidad de grupos adecuados para el analisis de datos.

```{r echo=FALSE}

library(tidyverse)  # data manipulation
library(cluster)    # clustering algorithms
library(factoextra)

set.seed(123)

elbow <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-1, -27)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(elbow, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")

```

Para realizar la grafica de codo se seleccionaron las variables cuantitativas que consideramos mas relevantes que en este caso fueron la cantidad de nacimientos por departamento.

El grafico antes mostrado nos indica que podemos hacer una eleccion de 3 o 5 clusters por lo que se decidira utilizar 3 clusters para el analisis de datos.


### - Agrupamiento

```{r echo=FALSE, warning=FALSE}
elbow <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-1, -27)


mydata <- elbow
a<- data.matrix(mydata)
km<-kmeans(a, 3, iter.max = 10, nstart = 1)
plot(a, col = km$cluster)
points(km$centers, col = 1:5, type= "p",pch = 8, cex = 10)

```

Luego del agrupamiento se obtuvo la grafica anterior similar a la anterior, sin embargo, dada la cantidad de datos y la cercania entre valores no se puede apreciar con certeza los clusters generados. Por lo que que decidimos separar los clusters por variables especificas. Por ejemplo, por departamento y su total de nacimientos.

De esta manera se pudo apreciar mejor la division entre grupoos. Y se realizo asi con todas las variables que considermaos necesarias para el analisis.

### - Calidad del Agrupamiento

```{r echo=FALSE}

elbow <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-1, -27)

avg_sil <- function(k) {
  km.res <- kmeans(na.omit(elbow), centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(elbow))
  mean(ss[, 3])
}
k.values <- 2:14
avg_sil_values <- sapply(k.values, avg_sil)
plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")

```

Al utilizar el metodo de la silueta podemos identificar el numero correcto de clusters a tratar que es de 3, el mimsmo que se eligio previamente. 

### - Hallazgos en el análisis exploratorio
***
Para realizar el análisis exploratorio se inició con la clasificación de las variables por cada uno de los sets de datos, iniciando por la variables que nos ayudaban a determinar el departamento de ocurrencia del nacimiento, entre estas variables están el mes, departamento y anio. 

Después se procedió a hacer análisis por agrupamientos donde se clasificaron los datos por edad de la madre, estado civil de la misma, nacimientos por escolaridad según el numero de hijos tenidos, entre otros. 

Pasando a la sección de la estadística descriptiva primero se procedió a hacer un analisis muy a grandes rasgos sobre las situación de nacimientos por cada departamento, durante los 10 anios. Dentro de esta seccion y también clasificado por departamento se indago sobre nacimientos por grupos de edad de la madre, según departamento y pueblo de pertenencia de la madre, nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia, entre otros. 

Pasando a los resultados y los hallazgos más relevante encontrados. Vemos que en la seccion de gráficos exploratorios existe una gran cantidad de diferencias entre la cantidad de nacidos por cada uno de los departamentos entre los departamentos con mayor cantidad de nacimientos se encuentran Guatemala, San Marcos y Huehuetenango. 

También pudimos determinar que entre todos los 10 anios de los cuales se tenia registro el 2015 es donde se ve uno de los mayores incrementos en la taza de nacimiento, y después de esto podemos ver que en los últimos años hemos observado una tendencia al decremento en la taza de nacimiento, aunque esta no es altamente significativa  también puede ser indicativo de otros factores. 

También se analizo las tendencias en los nacimientos a lo largo de los 10 anios, en este caso se decidió separar los departamentos en grupos de 7 y el ultimo de 8 departamentos, esta separación se hizo únicamente con objetivo de poder visualizarlo en un poco mas de orden, ya que  22 lineas habría sido difícil de comprender. 

Consecuente a eso se prodecio a hacer el mismo análisis pero con el porcentaje de muertes por el total de nacimientosen departamentos. Siguiendo la misma mecánica de sepacion entre grupos de 7 departamentos para facilidad de comprensión. Uno de los hallazgos mas importantes en estas graficas es que el comportamiento de las graficas de muerte son mucho mas dispersas que las de nacimientos, pues las graficas de nacimientos se encontraban bastante constantes en la mayoría de los departamentos. Versus las de mortalidad que tienen aumentos muy en pico y disminuciones de igual manera. 

En este caso encontrar una correlación entre nacimientos y muertes se hace bastante mas complicada pero se deja a futura exploración el poder determinar si existe alguna correlación entre estos 2 fenomenos.  Para finalizar con la parte de las graficas para los futuros análisis se agruparan por departamentos que tengan comportamientos similares entre nacimientos y muertes. Haciendo esto también se podrá determinar si existe alguna relación entre los comportamientos de las graficas y sus ubicaciones geográficas, abriendo la puerta a fenómenos económicos o ambientales localizados en cierto sector del país.

Luego saltamos a la sección de cómo es la distribución de los datos dentro del porcentaje de las mujeres solteras por cada departamento, también a través de los 10 anios. En la primera grafica podemos ver que los comportamientos son bastante constantes y en el departamento de Guatemala se pude ver una pendiente positiva al mismo tiempo que vemos un comportamiento oscilatorio.  Otra observación importante es que en las graficas de Sololá y Suchitepéquez son muy similares en cuestión de cifras y tendencias a aumento. Pasando a la graficas la de Izabal es una de las que tiene una mayor pendiente en aumento. 
Ya entrando a la parte de los nacimientos nos enfocamos bastante en el peso en que se registra al nacer. Esto con el objetivo de poder determinar en que departamento se tiene la tasa de nacimiento con nacidos bajo el peso ideal. También se investigó cual era el peso ideal para los recién nacidos y es un aproximado de 2.500 kg que se traduce a un aproximado de 5.51 libras. 

Según podemos ver en las graficas la tendencia de peso en todo el país es de 7.49 libras. Entrando un poco a los departamentos donde mas se obtuvieron nacimientos bajos en peso son Suchitepéquez y Peten, pero sin ser cifras sumamente significativas. Esto puede que tenga que ver mas con nacimientos prematuros u otros factores no tomados en cuenta. 

Por último una de las graficas que mas nos interesa indagar es la grafica de edad de las madres en todo el país. En esta queremos hacer notar que el rango de edades mas alto es entre los 18 y los 25 anios. Sin embargo tenemos un gran numero de embarazos en menos de edad, desde aproximadamente los 14 anios el crecimiento de embarazos entre niñas y adolescentes es una gran cantidad o porcentaje de todas las muestras.

Lo anterior nos da la pauta para poder indagar dentro de los datos e información de las madres niñas u adolescentes.  
***

### - Analisis de los Clusters de Datos
***
En este caso podemos ver que el metodo de agrupacion fue correcto al ver la grafica de la siluera promedio obtuvimos un avergade de 0.74 lo cual indica que el agrupamiento es adecuado. 

Para finalizar tenemos como resultado 3 clusters de informacion sobre los cuales se va a trabajar, en este caso se quiso saber mas acerca de los clusters por medio de arboles de desicion, sin embargo al momento de ejecutarse estos no fueron lo suficientemente accurate o precisos para poder ser tomados en cuenta dentro del analisis. 

***
### - Conclusiones
***
- Obtuvimos mucha infomacion acerca de como el departamento de Guatemala tiene una gran tendencia a tener los indices mas altos en casi todos los analisis. Invesigando un poco mas esto puede deberse a que es el departamento mas poblado del pais.

- Las tendencias en cifras de nacimiento ha disminuido en los ultimos anios, esto nos da paura para indagar sobre los departamentos donde esta tendencia fue mas marcada. 

- Existe una gran tendencia a embarazos en ninas y adolescentes. Estos nos marca la pauta que tenemos la infomacion  necesaria para poder cumplir con nuestros objetivos iniciales. 

- Las muertes tienen un comportamiento sumamente distinto a los nacimientos, pues en estos puede afectar una gran cantidad de factores. Concluimos que lo mejor sera clasificar las muertes por similitudes en el comportamiento de sus datos a travez de los anos para determinar si hay algun otro factor que influya en estos. 
***