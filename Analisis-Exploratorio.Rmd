---
title: "Proyecto 1"
author: "Juan De Leon, Maria Jose Castro, Jose Block"
date: "5/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Import libraries
library(ggplot2)
library(DataExplorer)
library(tidyverse)
library(reshape2)
library(grid)
library(corrplot)
 
# Load Data
load("DataMiningP1Project.RData")

```
# Analisis Exlporatorio
***

## Situación  Problemática
***
En Guatemala pasa que al hacer inversiones en ciertas areas como la educacion, se hace la inversion sin pensar en que sectores es mas eficiente invertir en educacion y resulta ser una inversion con un bajo impacto en el pais, porque resulta que hay sectores que lo necesitan.

## Problema científico
***
Con la informacion de nacimientos de 2009 a 2019 queremos hacer un analisis de datos para la inversion de educacion segun departamento tomando en cuenta cantidad de nacimientos por departamento y las condiciones de la madre de cada parto.

## Objetivos
***
- Averiguar que variables influyen mas en que la madre este soltera con un modelo.

- Determinar mayor taza de nacimientos por departamento y determinar orden de mayor a menor crecimiento o probabilidad de crecimiento de taza de nacimientos.

- Decidir un orden de departamentos en los que se debe invertir en educacion segun los datos analizados.

## Descripción  de  los  datos
***

  Para el desarrollo de este proyecto se trabajó con la base de datos de [Estadísticas Vitales](https://www.ine.gob.gt/ine/vitales/) del Instituto Nacional de Estadística de Guatemala (INE) desde el año 2010 al año 2019. Estas estadísticas provienen de registros administrativos de nacimientos, defunciones, matrimonios y divorcios. Las estadísticas vitales brindan información importante sobre los cambios de patrones en las áreas antes mencionadas, brindando así, una visión dinámica de la población.
  
  
  Dado que esta información está en archivos .xls el paso inicial que tomo el grupo fue juntar todos los sets de datos en un solo data frame por hoja que cada archivo contiene. Dado que se trabajo con información de 10 años distintos no en todos se cuantifica la misma información, por lo que fue necesario excluir ciertos datos que en archivos recientes si hay. Se agrego una columna a cada data frame para diferenciar el año en el que se obtuvo esa información. Seguido de esto se guardaron todos los data frames, habiendo unido la informacion de los 10 archivos distintos, en un archivo .RData.
  
  
  Luego de juntar los sets de datos se clasifico cuales iban a ser relevantes para solventar la problemática anteriormente planteada. Por lo que se escogieron los siguientes sets de datos: 


*	Nacimientos por departamento de residencia de la madre, según edades simples de la madre
*	Nacimientos por estado civil de la madre, según departamento de su residencia
*	Nacimientos por estado civil de la madre, según grupos de edad
*	Nacimientos por grupos de edad de la madre, según grupos de edad del padre
*	Número de hijos(as) tenidos, según edades simples de la madre
*	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia
*	Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre
*	Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre
*	Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

  
  Una de las ventajas que se tuvo al trabajar con este set de datos es que no fue sumamente necesaria la limpieza de datos. La mayoría de las hojas se encuentran llena de datos, no hay datos N/A. Sin embargo, a lo largo de los años se agregaron nuevas columnas o cambiaron de nombre, lo que se volvió un tanto tedioso. Fue necesario que variables cambiaron o que nueva información se agregó, ya que no se trabajó con datos que no se encontraran en los 10 años.

A continuación, mostramos una clasificación de las variables por cada set de datos:

*	Nacimientos por departamento de residencia de la madre, según edades simples de la madre

    * Edad: variable cuantitativa discreta.
    * Departamento: Variable cualitativa nominal

```{r echo=FALSE}
nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-2) %>% introduce()
```

* Nacimientos por departamento de residencia de la madre, segun departamento de ocurrencia
    * Mes: Variable cualitativa ordinal
    * Departamento: Variable cualitativa nominal
    * Total: Cuantitativa discreta
    * Hombres: Cuantitativa discreta
    * Mujeres: Cuantitativa discreta
    * Año: Cuantitativa discreta

```{r echo=FALSE}
nac_por_dpto %>% filter(Mes != "Todos los meses") %>% filter(Departamento.de.residencia != "Todos los departamentos") %>% select(-3) %>% introduce()
```

*	Nacimientos por estado civil de la madre, según departamento de su residencia
    
    * Departamento: Variable cualitativa nominal
    * Estado Civil: Variable cualitativa nominal

```{r echo=FALSE}
nac_por_estado_civil %>% filter(Departamento.de.residencia != "Todos los departamentos") %>% select(-2) %>% introduce()
```
    
*	Nacimientos por estado civil de la madre, según grupos de edad

    * Grupo de Edad: Variable cuantitativa discreta
    * Estado Civil: Variable cualitativa nominal
    
```{r echo=FALSE}
nac_por_estado_civil_por_edad %>% filter(Grupos.de.edad != "Todas las edades") %>% select(-2) %>% introduce()
```

*	Nacimientos por grupos de edad de la madre, según grupos de edad del padre

    * Grupo de Edad Madre: Variable cuantitativa discreta
    * Grupo de Edad Padre: Variable cuantitativa discreta

*	Número de hijos(as) tenidos, según edades simples de la madre

    * Edad: Variable cuantitativa discreta
    * Numero de Hijos: Variable cuantitativa discreta

*	Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia

    * Departamento: Variable cualitativa nominal
    * Municipio: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta
    
```{r echo=FALSE}
nac_edad_madre_departamento_municipio %>% filter(Departamento.de.residencia != "Todos los departamentos") %>% filter(Municipios != "Todos los municipios") %>% select(-3) %>% introduce()
```

*	Nacimientos por grupos de edad de la madre, según grandes grupos ocupacionales de la madre

    * Grupos Ocupacionales: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

```{r echo=FALSE}
nac_edad_madre_ocupacion %>% filter(Grupos.ocupacionales != "Todos los grupos ocupacionales") %>% select(-2) %>% introduce()
```

*	Nacimientos por edad de la madre, según departamento de residencia, área geográfica de ocurrencia, y grupo étnico de la madre

    * Departamento: Variable cualitativa nominal
    * Area Geografica: Variable cualitativa nominal
    * Grupo Etnico: Variable cualitativa nominal
    * Grupo de Edad: Variable cuantitativa discreta

```{r echo=FALSE}
nac_edad_madre_depto_area_etnia %>% filter(Departamento.de.ocurrencia != "Todos los departamentos") %>% filter(Pueblo.de.pertenencia.de.la.madre != "Todos los grupos étnicos") %>% select(-3) %>% introduce()
```

*	Nacimientos por escolaridad de la madre, según número de hijos(as) tenidos

    * Numero de hijos: variable cuantitativa discreta
    * Escolaridad de la madre: varibale cualitativa nominal

```{r echo=FALSE}
nac_escolaridad_madre %>% filter(Número.de.hijos.as. != "Todos los hijos") %>% select(-2) %>% introduce()
```

## Análisis Exploratorio
***

Para realizar el analisis, pensamos verificar que informacion nos es mas util entre las siguientes tablas:

- Nacimientos por departamento de residencia de la madre, según departamento de ocurrencia							

- Nacimientos por estado civil de la madre, según departamento de su residencia							

- Nacimientos vivos y muertos por tipo de parto, según departamento de residencia de la madre							

- Nacimientos por sexo, según departamento de residencia de la madre y peso del niño(a) al nacer							

- Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia							

- Nacimientos por grupos de edad de la madre, según departamento y pueblo de pertenencia de la madre

- Nacimientos por lugar donde ocurrió el nacimiento, según departamento y municipio de residencia de la madre	


### - Estadística Descriptiva

A continuación se muestran los nombres de cada dataframe y su estadística descriptiva por cada una de las tablas ya mencionadas.

- Nacimientos por departamento de residencia de la madre, según departamento de ocurrencia

Resumen estadístico de variables:

```{r echo=FALSE}
smry1 <- dpto_res_ocu %>% select(2:26)
summary(smry1)
```

- Nacimientos por estado civil de la madre, según departamento de su residencia				

Resumen estadístico de variables:

```{r echo=FALSE}
smry2 <- nac_por_estado_civil %>% select(2:6)
summary(smry2)
```
- Nacimientos por departamento

Dentro de las preguntas interesantes, orientadas a nuestra problematica, surgio la curiosidad por saber cuantos nacimientos hubo a lo largo de 10 años en todos los departamentos de la republica. Para resolver esta duda se utilizo el data set de nacimientos por  departamento. Obtuvimos los siguientes resultados:

```{r echo=FALSE}

nac_por_dpto_todas_las_edades <- nac_por_dpto_edades_simples %>% filter(Edad == "Todas las edades") %>% select(-1, -2)

# Plot of births per city per year
barplot(as.matrix(nac_por_dpto_todas_las_edades %>% select(-25)), beside=TRUE, las=2)
```
- Nacimientos vivos y muertos por tipo de parto, según departamento de residencia de la madre		

Resumen estadístico de variables:

```{r echo=FALSE}
smry3 <- nac_vivos_muertos_por_dpto %>% select(2:7)
summary(smry3)
```

- Nacimientos por sexo, según departamento de residencia de la madre y peso del niño(a) al nacer							

Resumen estadístico de variables:

```{r echo=FALSE}
smry4 <- nac_depto_sexo_peso %>% select(2:5)
summary(smry4)
```

- Nacimientos por grupos de edad de la madre, según departamento y municipio de su residencia

Resumen estadístico de variables:

```{r echo=FALSE}
smry5 <- nac_edad_madre_departamento_municipio %>% select(3:13)
summary(smry5)
```

- Nacimientos por grupos de edad de la madre, según departamento y pueblo de pertenencia de la madre

Resumen estadístico de variables:

```{r echo=FALSE}
smry6 <- nac_edad_madre_depto_area_etnia %>% select(2:13)
summary(smry6)
```

- Nacimientos por lugar donde ocurrió el nacimiento, según departamento y municipio de residencia de la madre	

Resumen estadístico de variables:

```{r echo=FALSE}
smry7 <- nac_lugar %>% select(3:11)
summary(smry7)

```

### - Gráficos  Exploratorios
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Separar la info para dar graficos 
#Guatemala
#Zacapa
#Totonicapán
#Suchitepéquez
#Sololá
#Santa Rosa
#San Marcos
#Sacatepéquez

#Retalhuleu
#Quiché
#Quetzaltenango 
#Petén
#Jutiapa
#Jalapa
#Izabal

#Huehuetenango
#Escuintla
#El Progreso
#Chiquimula
#Chimaltenango
#Baja Verapaz
#Alta Verapaz

nac_depto_sexo_peso0 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Guatemala" & Peso == "Todos los pesos")

nac_depto_sexo_peso1 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Suchitepéquez" & Peso == "Todos los pesos")

nac_depto_sexo_peso2 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Zacapa" & Peso == "Todos los pesos")

nac_depto_sexo_peso3 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Totonicapán" & Peso == "Todos los pesos")

nac_depto_sexo_peso4 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Sololá" & Peso == "Todos los pesos")

nac_depto_sexo_peso5 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Santa Rosa" & Peso == "Todos los pesos")

nac_depto_sexo_peso6 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "San Marcos" & Peso == "Todos los pesos")

nac_depto_sexo_peso7 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Sacatepéquez" & Peso == "Todos los pesos")

nac_depto_sexo_peso8 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Retalhuleu" & Peso == "Todos los pesos")

nac_depto_sexo_peso9 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Quiché" & Peso == "Todos los pesos")

nac_depto_sexo_peso10 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Quetzaltenango" & Peso == "Todos los pesos")

nac_depto_sexo_peso11 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Petén" & Peso == "Todos los pesos")

nac_depto_sexo_peso12 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Jutiapa" & Peso == "Todos los pesos")

nac_depto_sexo_peso13 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Jalapa" & Peso == "Todos los pesos")

nac_depto_sexo_peso14 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Izabal" & Peso == "Todos los pesos")

nac_depto_sexo_peso15 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Huehuetenango" & Peso == "Todos los pesos")

nac_depto_sexo_peso16 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Escuintla" & Peso == "Todos los pesos")

nac_depto_sexo_peso17 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "El Progreso" & Peso == "Todos los pesos")

nac_depto_sexo_peso18 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Chiquimula" & Peso == "Todos los pesos")

nac_depto_sexo_peso19 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Chimaltenango" & Peso == "Todos los pesos")

nac_depto_sexo_peso20 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Baja Verapaz" & Peso == "Todos los pesos")

nac_depto_sexo_peso21 <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Alta Verapaz" & Peso == "Todos los pesos")

#Graficar Guatemala por aparte y luego se grafica de 7 en 7.

ggplot(data=nac_depto_sexo_peso0, aes(x=anio, y=Total, group=1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en Guatemala(departamento)") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)

d <- melt(list(Suchitepequez = nac_depto_sexo_peso1,Zacapa = nac_depto_sexo_peso2,Totonicapan = nac_depto_sexo_peso3,Solola = nac_depto_sexo_peso4,Santa_Rosa = nac_depto_sexo_peso5,San_Marcos = nac_depto_sexo_peso6, Sacatepequez = nac_depto_sexo_peso7), id.vars = c("anio", "Total"))
ggplot(d, aes(x=anio, y=Total, colour = L1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en departamentos de Guatemala") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)
```
Si analizamos individualmente los departamentos observamos que las cifras van en aumento, alcanzan un maximo y luego descienden.



```{r echo=FALSE}
plot_boxplot(nac_por_dpto_todas_las_edades, by="anio")
```

Tambien nos preguntamos como se distribuian los datos en relacion con los nacimientos, el peso del bebe y su departamento de nacimiento. Se obtuvieron los siguientes resultados:

```{r echo=FALSE}

listado_de_departamentos <- nac_depto_sexo_peso$Departamento.de.residencia
listado_de_departamentos <- listado_de_departamentos[!duplicated(listado_de_departamentos)]

for (variable in listado_de_departamentos) {
  print(variable)
  nac_guatemala_sexo_peso <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == variable) %>% filter(Peso != "Todos los pesos") %>% select(-1, -4, -5)
nac_guatemala_sexo_peso_clean <- aggregate(nac_guatemala_sexo_peso$Total, by=list(nac_guatemala_sexo_peso$Peso), FUN = sum)
barplot(nac_guatemala_sexo_peso_clean$x, names.arg = nac_guatemala_sexo_peso_clean$Group.1, las=2)
}

#nac_guatemala_sexo_peso <- nac_depto_sexo_peso %>% filter(Departamento.de.residencia == "Guatemala") %>% filter(Peso != "Todos los pesos") %>% select(-1, -4, -5)
#nac_guatemala_sexo_peso_clean <- aggregate(nac_guatemala_sexo_peso$Total, by=list(nac_guatemala_sexo_peso$Peso), FUN = sum)
#barplot(nac_guatemala_sexo_peso_clean$x, names.arg = nac_guatemala_sexo_peso_clean$Group.1, las=2)

```


Luego de esto se quizo ver como era la distribucion de nacimientos por edades, se obtuvieron los siguientes resultados:

```{r echo=FALSE}
nac_por_edad <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(1, 2, 27)
nac_por_edad <- aggregate(nac_por_dpto_edades_simples$Total, by=list(nac_por_dpto_edades_simples$Edad), FUN=sum)
nac_por_edad <- head(nac_por_edad, - 1)
barplot(nac_por_edad$x, names.arg = nac_por_edad$Group.1, las=2)
```

- Nacimientos por departamento

```{r echo=FALSE}
d2 <- melt(list(Retalhuleu = nac_depto_sexo_peso8,Quiche = nac_depto_sexo_peso9,Quetzaltenango = nac_depto_sexo_peso10,Peten = nac_depto_sexo_peso11,Jutiapa = nac_depto_sexo_peso12,Jalapa = nac_depto_sexo_peso13, Izabal = nac_depto_sexo_peso14), id.vars = c("anio", "Total"))
ggplot(d2, aes(x=anio, y=Total, colour = L1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en departamentos de Guatemala") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)

d3 <- melt(list(Huehuetenango = nac_depto_sexo_peso15,Escuintla = nac_depto_sexo_peso16,El_Progreso = nac_depto_sexo_peso17,Chiquimula = nac_depto_sexo_peso18,Chimaltenango = nac_depto_sexo_peso19,Baja_Verapaz = nac_depto_sexo_peso20, Alta_Verapaz = nac_depto_sexo_peso21), id.vars = c("anio", "Total"))
ggplot(d3, aes(x=anio, y=Total, colour = L1)) + geom_line() + geom_point() + ggtitle("Nacimientos por año en departamentos de Guatemala") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous("Año", labels = as.character(nac_depto_sexo_peso1$anio), breaks = nac_depto_sexo_peso1$anio)


#Graficar
#Cantidad de nacimientos en el transcurso del tiempo 
#por cada departamento.
#Selecciono la info para tener los departamentos en una variable
#deptotanio <- dpto_res_ocu_tot %>% select(3,4,5,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
##Se repite...
#deptotanio <- dpto_res_ocu_tot %>% select(6,7,8,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
#deptotanio <- dpto_res_ocu_tot %>% select(8,10,11,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
#deptotanio <- dpto_res_ocu_tot %>% select(12,13,14,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
#deptotanio <- dpto_res_ocu_tot %>% select(15,16,17,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
#deptotanio <- dpto_res_ocu_tot %>% select(18,19,20,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
#deptotanio <- dpto_res_ocu_tot %>% select(21,22,23,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
#deptotanio <- dpto_res_ocu_tot %>% select(24,25,26,27)
#d <- melt(deptotanio, id.vars="anio")
#ggplot(d, aes(x = anio,value)) + geom_line() + facet_wrap(~variable, #ncol = 1, scales = "free")
```

### - Correlaciones  Entre  las  Variables

Para hacer el estudio de correlación para cada tabla, solo se puede aplicar a variables cuantitativas, se investigó si se puede convertir las variables cuantitativas a numeros diferentes aleatorios, pero las únicas formas que encontramos eran muy complejas en cuestion de tiempo. Por esta razón, se hizo el estudio de correlaión solo entre variables cuantitativas actuales.
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Check correlation
frstselect <- subset (dpto_res_ocu, select = c(2:27))
M <- cor(frstselect)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(M,  method = "color", col = col(200), order = "hclust", number.cex = .35,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)

scndselect <- subset (nac_edad_madre_departamento_municipio, select = c(3:14))
M2 <- cor(scndselect)
corrplot(M2,  method = "color", col = col(200), order = "hclust", number.cex = .7,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)

trdselect <- subset (nac_depto_sexo_peso, select = c(3:6))
M3 <- cor(trdselect)
corrplot(M3,  method = "color", col = col(200), order = "hclust", number.cex = 1.5,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)
frthselect <- subset (nac_por_estado_civil, select = c(2:7))
M4 <- cor(frthselect)
corrplot(M4,  method = "color", col = col(200), order = "hclust", number.cex = 1.5,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)
fthselect <- subset (nac_vivos_muertos_por_dpto, select = c(2:9))
fthselect = fthselect[rowSums(is.na(fthselect)) == 0, ]
M5 <- cor(fthselect)
corrplot(M5,  method = "color", col = col(200), order = "hclust", number.cex = 1,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)

sthselect <- subset (nac_edad_madre_depto_area_etnia, select = c(3:14))
sthselect = sthselect[rowSums(is.na(sthselect)) == 0, ]
M6 <- cor(sthselect)
corrplot(M6,  method = "color", col = col(200), order = "hclust", number.cex = .8,
         addCoef.col = "black", # Add coefficient of correlation
         tl.col = "black", 
         # Text label color and rotation
         # Combine with significance
         sig.level = 0.50, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag = FALSE)
```

### - Variables Categóricas
### - Número de Clusters

Para analizar de mejor manera la informacion se hara un agrupamiento. Por lo que se hara una grafica de codo para determinar la cantidad de grupos adecuados para el analisis de datos.

```{r echo=FALSE}

library(tidyverse)  # data manipulation
library(cluster)    # clustering algorithms
library(factoextra)

elbow <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-1, -27)

avg_sil <- function(k) {
  km.res <- kmeans(na.omit(elbow), centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(elbow))
  mean(ss[, 3])
}
k.values <- 2:14
avg_sil_values <- sapply(k.values, avg_sil)
plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")

```

Para realizar la grafica de codo se seleccionaron las variables cuantitativas que consideramos mas relevantes que en este caso fueron la cantidad de nacimientos por departamento.

El grafico antes mostrado nos indica que podemos hacer una eleccion de 3 o 5 clusters por lo que se decidira utilizar 3 clusters para el analisis de datos.


### - Agrupamiento

```{r echo=FALSE, warning=FALSE}
elbow <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-1, -27)


mydata <- elbow
a<- data.matrix(mydata)
km<-kmeans(a, 3, iter.max = 10, nstart = 1)
plot(a, col = km$cluster)
points(km$centers, col = 1:5, type= "p",pch = 8, cex = 10)

```

Luego del agrupamiento se obtuvo la grafica anterior similar a la anterior, sin embargo, dada la cantidad de datos y la cercania entre valores no se puede apreciar con certeza los clusters generados. Por lo que que decidimos separar los clusters por variables especificas. Por ejemplo, por departamento y su total de nacimientos.

De esta manera se pudo apreciar mejor la division entre grupoos. Y se realizo asi con todas las variables que considermaos necesarias para el analisis.

### - Calidad del Agrupamiento

```{r echo=FALSE}

set.seed(123)

elbow <- nac_por_dpto_edades_simples %>% filter(Edad != "Todas las edades") %>% select(-1, -27)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(elbow, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")

```

Al utilizar el metodo de la silueta podemos identificar el numero correcto de clusters a tratar que es de 3, el mimsmo que se eligio previamente. 

## Hallazgos y conclusiones
***
### - Hallazgos en el análisis exploratorio
### - Nombre a los grupos
### - Conclusiones